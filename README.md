<div align="center">

# 群聊扫把星（ChatBanter）

</div>

<p align="center">
  <img src="https://img.shields.io/badge/License-AGPL_3.0-blue.svg" alt="License: AGPL-3.0">
  <img src="https://img.shields.io/badge/Python-3.10+-yellow.svg" alt="Python 3.10+">
  <img src="https://img.shields.io/badge/AstrBot-v4.x.x-orange.svg" alt="AstrBot v4.x.x">
</p>

<p align="center">
  <img src="https://count.getloli.com/@Brick0411andhisbot?name=Brick0411andhisbot&theme=booru-lisu&padding=10&offset=0&align=center&scale=0.8&pixelated=1&darkmode=1" alt="Moe Counter">
</p>

一个基于 **AstrBot v4.x** 的群聊娱乐插件，支持**每日运势**、**迫害群友**和**特殊问候**等功能。

感谢**ChatGPT**和**官方文档**的技术指导，如果没有它们的帮助，我可能连怎么写插件都很难学会。

还有一些功能没有实装，等测试无误了再上传。

## 时间线

$2025$ 年 $12$ 月 $20$ 日 - 插件开始编写；

$2025$ 年 $12$ 月 $23$ 日 - 插件编写收尾，总工期（包括学习、调教和编写）约为 $23$ 小时左右；

$2025$ 年 $12$ 月 $24$ 日 - 插件测试完毕；

$2026$ 年 $1$ 月 $2$ 日 - 第 $1$ 版 README 编写完成；

$2026$ 年 $1$ 月 $2$ 日 - 第 $2$ 版 README 编写完成；

$2026$ 年 $1$ 月 $3$ 日 - 第 $1$ 版项目上传。

## 插件信息

- **插件名**：ChatBanter
- **作者**：Bricks0411
- **版本**：0.0.3
- **适配框架**：AstrBot v4.x.x
- **平台**：NapCat / aiocqhttp（WebSocket 反向连接）

## 功能列表

#### 今日运势

- 指令格式：

```
/今日运势
/运势
```

- 功能说明：

  - 每人每天固定一个运势
  - 运势基于 `QQ号 + 日期` 生成
  - 包含：
    - 幸运值（$1$ ~ $100$）
    - 运势等级（大吉 / 中吉 / 小吉 / 平 / 凶）
    - 今日宜 / 忌
  - 当幸运值 ≥ $90$ 时触发「诸事皆宜」

示例输出：

  ```
【今日运势】
用户：Alice
🍀 今日人品：88
📈 运势：中吉
✅ 宜：摸鱼
❌ 忌：加班
  ```

#### 今日运势排行榜

- 指令格式：

```
/运势排行
/今日运势排行
/运势排行榜
```

- 功能说明：

  - 按当日运势值排序
  - 显示前 $10$ 名
  - 🥇🥈🥉 自动标注前三名
  - 排行数据按天存储

功能示例：

  ```
【今日运势排行榜】
🥇 Alice  99
🥈 Brick  92
🥉 Carol  87
4️⃣ Dave   76
  ```

#### 特殊问候

- 自动触发，无需指令，群聊/私聊均支持；
- 支持关键词：
  - 早安类：`早安 / 早上好 / good morning ...`
  - 晚安类：`晚安 / good night / wanan ...`
- 内置 **傲娇风格回复**。

#### 伪造发言（娱乐）

- 指令格式：

```
@Bot /说 @某人 内容
```

- 功能说明：

  - 让 Bot 以**指定群成员的名义**发送消息；
  - 仅供娱乐，请谨慎使用。

#### 简单数学指令（示例）

- 加法：

  ```
  /add 1 2
  ```

- 减法：

  ```
  /sub 5 3
  ```

## 数据存储说明

#### 运势排行榜文件

- 路径：

  ```
  data/plugins/ChatBanter-main/fortune_rank.json
  ```

- 数据结构示例：

```json
{
  "2026-01-03": {
    "123456": {
      "name": "Alice",
      "luck": 88
    }
  }
}
```

## 并发安全说明

- 使用 `asyncio.Lock` 保证排行榜写入互斥；
- 使用 `tempfile + os.replace` 实现**文件写入原子化**；
- 避免高并发场景下可能产生的数据丢失和损坏。

## 安装方法

1. 将插件文件夹放入：

   ```
   AstrBot/data/plugins/
   ```

2. 启动 AstrBot；

3. 在 WebUI 中确认插件已加载；

4. 在群内测试指令。

## 注意事项

- 本插件主要用于**学习与测试**；
- **伪造发言功能可能引发不必要的误会，请谨慎使用**；
- 可能与其它（早安/晚安）机器人**产生冲突**，请酌情处理。

## TODO

#### 每日运势

- **图片渲染**运势与排行榜；
- 运势红黑榜；
- 连续签到成就；
- 群专属彩蛋 / 群主特权；
- 基于LLM的运势锐评。

#### 伪造发言

- 实现多条伪造消息的拼接/嵌套。

#### 特殊问候

- 实现基于LLM的特殊早晚问候。

#### AstrBot

- WebUI 配置开关。

#### 新功能

- 群友属性系统：
  - 根据群友每日互动而变化；
  - 支持不同群友之间决斗；
  - 配合**今日运势**功能添加永久属性加成。
- 俄罗斯轮盘，支持 $2$ 人同玩。胜者有赏，败者食尘。
- Codeforces 平台跟踪
  - 基本信息展示；
  - 群友账号绑定；
  - 群友过题通报；
  - 每日一题推送等。

## License

MIT / 学习用途自由修改
