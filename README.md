<div align="center">

# 群聊扫把星（ChatBanter）

</div>

<p align="center">
  <img src="https://img.shields.io/badge/License-AGPL_3.0-blue.svg" alt="License: AGPL-3.0">
  <img src="https://img.shields.io/badge/Python-3.10+-yellow.svg" alt="Python 3.10+">
  <img src="https://img.shields.io/badge/AstrBot-v4.5.7+-orange.svg" alt="AstrBot v4.5.7+">
</p>


<p align="center">
  <img src="https://count.getloli.com/@Brick0411andhisbot?name=Brick0411andhisbot&theme=booru-lisu&padding=10&offset=0&align=center&scale=0.8&pixelated=1&darkmode=1" alt="Moe Counter">
</p>

这个项目是一个基于 **AstrBot v4.5.7 +** 版本的群聊娱乐插件，支持**每日运势**、**迫害群友**和**特殊问候**等功能。

感谢 **ChatGPT** 和**官方文档**的技术指导，如果没有它们的帮助，我应该连怎么写插件都很难学会。

插件接入 LLM 的功能是 ChatGPT 帮忙实现的，这也是我在 $1$ 月 $3$ 日能高效更新两次的原因。

还有一些功能没有实装，等测试无误了再上传。

**请不要使用 v0.1.0！这个版本因 json 文件不适配，暂时无法使用！**

## 时间线

$2025$ 年 $12$ 月 $20$ 日 - 插件开始编写；

$2025$ 年 $12$ 月 $23$ 日 - 插件编写收尾，总工期（包括学习、调教和编写）约为 $23$ 小时左右；

$2025$ 年 $12$ 月 $24$ 日 - 插件测试完毕；

$2026$ 年 $1$ 月 $2$ 日 - 第 $0.0.5$ 版 README 编写完成；

$2026$ 年 $1$ 月 $3$ 日 - 第 $0.0.5$ 版项目上传。

$2026$ 年 $1$ 月 $3$ 日 - 第 $0.0.6$ 版 README 编写完成；

$2026$ 年 $1$ 月 $3$ 日 - 第 $0.0.6$ 版项目上传。

$2026$ 年 $1$ 月 $4$ 日 - 第 $0.1.0$ 版项目上传。

## 插件信息

- **插件名**：ChatBanter
- **作者**：Bricks0411
- **版本**：0.1.0 ❌ **请不要使用该版本！**
- **适配框架**：AstrBot v4.5.7 +
- **平台**：NapCat / aiocqhttp（WebSocket 反向连接）
- **适配平台**：QQ 个人号。

## 功能列表

#### 今日运势

- 指令格式：

```
/今日运势
/运势
```

- 功能说明：

  - 每人每天固定一个运势
  - 运势基于 `QQ号 + 日期` 生成
  - 包含：
    - 幸运值（ $1$ ~ $100$ ）
    - 运势等级（大吉 / 中吉 / 小吉 / 平 / 凶）
    - 今日宜 / 忌
  - 当幸运值 ≥ $90$ 时触发「诸事皆宜」
  - 最后会给出 LLM 生成的「运势锐评」。

示例输出：

  ```
【今日运势】
用户：Alice
🍀 今日人品：88
📈 运势：中吉
✅ 宜：摸鱼
❌ 忌：加班
📝 今日评价：运势不错，今天也要加油呀！
  ```

#### 今日运势排行榜

- 指令格式：

```
/运势排行
/今日运势排行
/运势排行榜
```

- 功能说明：

  - 按当日运势值排序
  - 显示前 $10$ 名
  - 🥇🥈🥉 自动标注前三名
  - 排行数据按天存储

功能示例：

  ```
【今日运势排行榜】
🥇 Alice  99
🥈 Brick  92
🥉 Carol  87
4️⃣ Dave   76
  ```

#### 特殊问候

- 自动触发，无需指令，群聊/私聊均支持；
- 支持关键词：
  - 早安类：`早安 / 早上好 / good morning ...`
  - 晚安类：`晚安 / good night / wanan ...`
- 内置 **傲娇风格回复**。

#### 伪造发言（娱乐）

- 指令格式：

```
@Bot /说 @某人 内容
```

- 功能说明：

  - 让 Bot 以**指定群成员的名义**发送消息；
  - 仅供娱乐，请谨慎使用。

#### 简单数学指令（示例）

- 加法：

  ```
  /add 1 2
  ```

- 减法：

  ```
  /sub 5 3
  ```

## 数据存储说明

#### 运势排行榜文件

- 路径：

  ```
  data/plugins/ChatBanter-main/fortune_rank.json
  ```

- 数据结构示例：

```json
{
  "2026-01-03": {
    "123456": {
      "name": "Alice",
      "luck": 88
    }
  }
}
```

## 并发安全说明

- 使用 `asyncio.Lock` 保证排行榜写入互斥；
- 使用 `tempfile + os.replace` 实现**文件写入原子化**；
- 避免高并发场景下可能产生的数据丢失和损坏。

## 安装方法

1. 将插件文件夹放入：

   ```
   AstrBot/data/plugins/
   ```

2. 启动 AstrBot；

3. 在 WebUI 中确认插件已加载；

4. 在群内测试指令。

## 注意事项

- 本插件主要用于**学习与测试**；
- **伪造发言功能可能引发不必要的误会，请谨慎使用**；
- 可能与其它（早安/晚安）机器人**产生冲突**，请酌情处理。

## TODO

#### 每日运势

- **图片渲染**运势与排行榜；
- 运势红黑榜；
- 连续签到成就；
- 群专属彩蛋 / 群主特权。

#### 伪造发言

- 实现多条伪造消息的拼接/嵌套。

#### 特殊问候

- 实现基于LLM的特殊早晚问候。

#### AstrBot

- WebUI 配置开关。

#### 新功能

- 群友属性系统：
  - 根据群友每日互动而变化；
  - 支持不同群友之间决斗；
  - 配合**今日运势**功能添加永久属性加成。
- 俄罗斯轮盘，支持 $2$ 人同玩。胜者有赏，败者食尘。
- Codeforces 平台跟踪
  - 基本信息展示；
  - 群友账号绑定；
  - 群友过题通报；
  - 每日一题推送等。

## 历史版本信息

|  版本   |     时间     |               更新内容               |                     备注                     |
| :-----: | :----------: | :----------------------------------: | :------------------------------------------: |
| $0.0.3$ | $2025.12.23$ | 最初版，支持特殊问候、伪造发言等功能 |                      ✅                       |
| $0.0.5$ |  $2025.1.2$  |    使用随机化算法实现用户运势求取    |                      ✅                       |
| $0.0.6$ |  $2025.1.3$  |   接入 LLM，实现锐评每日运势的功能   | ✅ 暂时不支持自定义LLM prompt，后续版本会更新 |
| $0.1.0$ |  $2025.1.4$  | 添加配置文件，支持自定义配置功能参数 |         ❌ 该版本无法在Astrbot中使用          |

## License

MIT / 学习用途可自由修改
